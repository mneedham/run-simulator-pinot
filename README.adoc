= Building a run simulator with Apache Pinot

This repository contains the code demonstrated in the https://www.meetup.com/apache-pinot/events/283880626/[Building a Run Simulator with Pinot and Streamlit] meetup.

== Setup

[source, bash]
----
docker-compose up
----

[source, bash]
----
docker exec -it pinot-controller-strava bin/pinot-admin.sh AddTable   \
  -tableConfigFile /config/table-realtime-races.json   \
  -schemaFile /config/schema-races.json -exec
----

[source, bash]
----
docker exec -it pinot-controller-strava bin/pinot-admin.sh AddTable   \
  -tableConfigFile /config/table-realtime-parkrun.json   \
  -schemaFile /config/schema-parkrun.json -exec
----

[source, bash]
----
docker exec -it pinot-controller-strava bin/pinot-admin.sh AddTable   \
  -tableConfigFile /config/table-dim-courses.json   \
  -schemaFile /config/schema-courses.json -exec
----


[source, bash]
----
docker exec \
  -it pinot-controller-strava bin/pinot-admin.sh LaunchDataIngestionJob \
  -jobSpecFile /config/job-spec-courses.yml
----


== Race generator

.Launch the race generator
[source, bash]
----
streamlit run create_race.py
----

.Check for generated messages
[source, bash]
----
docker exec -it kafka-strava kafka-console-consumer.sh \
  --bootstrap-server localhost:9092 \
  --topic parkrun
----

== Real-Time Dashboard


[source, bash]
----
docker exec -it kafka-strava kafka-topics.sh \
  --bootstrap-server localhost:9092 \
  --describe \
  --topic activities
----

.Create topic with partitions
[source, bash]
----
docker exec -it kafka-strava kafka-topics.sh \
  --bootstrap-server localhost:9092 \
  --create \
  --topic activities \
  --partitions 10
----

.Stream messages for topic / partition
[source,bash]
----
docker exec -it kafka-strava kafka-console-consumer.sh \
  --bootstrap-server localhost:9092 \
  --topic activities \
  --partition 2 \
  --from-beginning
----

.Offsets for each partition
[source, bash]
----
docker exec -it kafka-strava kafka-run-class.sh kafka.tools.GetOffsetShell \
  --broker-list localhost:9092 \
  --topic activities
----